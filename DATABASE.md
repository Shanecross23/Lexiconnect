# Lexiconnect Neo4j Database Documentation

## Overview
Lexiconnect uses Neo4j as its primary database, implementing a graph structure specifically designed for linguistic analysis and documentation. This document outlines the database schema, node types, relationships, and common usage patterns.

## Node Types

### 1. Text
- **Label**: `Text`
- **Required Properties**:
  - `ID` (unique)
- **Description**: Root container for linguistic documents
- **Usage**: Each Text node represents a complete document or text being analyzed
- **Example**:
```cypher
CREATE (t:Text {ID: "text-001", title: "Sample Text"})
```

### 2. Section
- **Label**: `Section`
- **Required Properties**:
  - `ID` (unique)
- **Description**: Subdivisions of a Text (e.g., paragraphs, chapters)
- **Relationships**:
  - `SECTION_PART_OF_TEXT` ← connects to Text
  - `SECTION_CONTAINS` → connects to Words
  - `PHRASE_IN_SECTION` → connects to Phrases
- **Example**:
```cypher
MATCH (t:Text {ID: "text-001"})
CREATE (s:Section {ID: "section-001"})
CREATE (t)-[:SECTION_PART_OF_TEXT]->(s)
```

### 3. Phrase
- **Label**: `Phrase`
- **Required Properties**:
  - `ID` (unique)
- **Description**: Collection of words forming a linguistic phrase
- **Relationships**:
  - `PHRASE_COMPOSED_OF` → connects to Words (with Order property)
  - Can be analyzed by Gloss nodes
- **Example**:
```cypher
CREATE (p:Phrase {ID: "phrase-001"})-[:PHRASE_COMPOSED_OF {Order: 0}]->(w:Word)
```

### 4. Word
- **Label**: `Word`
- **Required Properties**:
  - `ID` (unique)
- **Description**: Individual words in the text
- **Relationships**:
  - `WORD_MADE_OF` → connects to Morphemes
  - Can be contained in Sections and Phrases
  - Can be analyzed by Gloss nodes
- **Example**:
```cypher
CREATE (w:Word {ID: "word-001", value: "running"})
```

### 5. Morpheme
- **Label**: `Morpheme`
- **Required Properties**:
  - `ID` (unique)
- **Description**: Smallest meaningful units of language
- **Relationships**:
  - Can be part of Words
  - Can be analyzed by Gloss nodes
- **Example**:
```cypher
MATCH (w:Word {ID: "word-001"})
CREATE (m:Morpheme {ID: "morph-001", value: "run"})
CREATE (w)-[:WORD_MADE_OF]->(m)
```

### 6. Gloss
- **Label**: `Gloss`
- **Required Properties**:
  - `ID` (unique)
- **Description**: Linguistic analysis annotations
- **Relationships**:
  - `ANALYZES` → can connect to Words, Phrases, or Morphemes
- **Example**:
```cypher
CREATE (g:Gloss {ID: "gloss-001", annotation: "present participle"})
CREATE (g)-[:ANALYZES]->(w:Word {ID: "word-001"})
```

### 7. User
- **Label**: `User`
- **Required Properties**:
  - `ID` (unique)
- **Description**: System users with access permissions
- **Relationships**:
  - `HAS_PERMISSIONS` → connects to Texts they can access
- **Example**:
```cypher
CREATE (u:User {ID: "user-001"})-[:HAS_PERMISSIONS]->(t:Text)
```

## Relationship Types

1. **WORD_MADE_OF**
   - Direction: Word → Morpheme
   - Usage: Connects words to their constituent morphemes

2. **PHRASE_COMPOSED_OF**
   - Direction: Phrase → Word
   - Properties: `Order` (integer)
   - Usage: Shows word order in phrases

3. **SECTION_CONTAINS**
   - Direction: Section → Word
   - Usage: Links sections to their constituent words

4. **PHRASE_IN_SECTION**
   - Direction: Section → Phrase
   - Usage: Associates phrases with their containing sections

5. **SECTION_PART_OF_TEXT**
   - Direction: Text → Section
   - Usage: Organizes sections within texts

6. **ANALYZES**
   - Direction: Gloss → (Word|Phrase|Morpheme)
   - Usage: Connects linguistic annotations to language units

7. **HAS_PERMISSIONS**
   - Direction: User → Text
   - Usage: Defines user access rights to texts

## Common Queries

### Find all words in a text
```cypher
MATCH (t:Text {ID: $textId})-[:SECTION_PART_OF_TEXT]->(s:Section)-[:SECTION_CONTAINS]->(w:Word)
RETURN w
```

### Get phrase with its ordered words
```cypher
MATCH (p:Phrase {ID: $phraseId})-[r:PHRASE_COMPOSED_OF]->(w:Word)
RETURN w
ORDER BY r.Order
```

### Get all glosses for a word
```cypher
MATCH (g:Gloss)-[:ANALYZES]->(w:Word {ID: $wordId})
RETURN g
```

## Best Practices

1. **ID Generation**
   - Always use unique, prefixed IDs (e.g., "word-", "phrase-", "text-")
   - IDs should be generated by the application, not the database

2. **Relationships**
   - Always create relationships when creating related nodes
   - Maintain the correct direction of relationships as specified

3. **Queries**
   - Use parameters (`$paramName`) instead of string concatenation
   - Include appropriate indexes for frequently queried properties

4. **Constraints**
   - All node types require unique IDs
   - Constraints are automatically applied via schema.cypher

## Schema Maintenance

The schema is maintained in `backend/app/migrations/neo4j/schema.cypher` and is automatically applied when:
1. Running `./start-free.sh`
2. Manually running `./apply-schema.sh`

## Visualization

To visualize the database structure:
1. Open Neo4j Browser (http://localhost:7474)
2. Run: `CALL db.schema.visualization()`
